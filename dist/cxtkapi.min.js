!function(){function t(){this.pid="",this.etProxy="https://",this.referer="http://",this.pgid=null,this.etcode=null}t.prototype.init=function(t){this.etProxy=t.etProxy,this.pid=t.pid,this.referer=t.referer},t.clear=function(){wx.removeStorage({key:"amvid"}),wx.removeStorage({key:"etcode"})},t.prototype.getLink=function(t,e){function o(t){var e,o,r,d="",a="",p="abcdef0123456789",s=n.substr(1),h=Math;if(c.pgid=wx.getStorageSync("amvid"),!c.pgid){a=i(s,8)+i(p,16);for(var e=1;32>=e;e++)o=h.floor(16*h.random()),a&&e<=a.length&&(r=a.charCodeAt(e-1),o=(o+r)%16),d+=o.toString(16);c.pgid=d,wx.setStorage({key:"amvid",data:c.pgid})}t(c.pgid)}function i(t,e){var o,i="",r=1;if(r=Math.floor(t.length/e),1==r)i=t.substr(0,e);else for(o=0;e>o;o++)i+=t.substr(o*r,1);return i}function r(t){var e;c.etcode=wx.getStorageSync("etcode"),c.etcode?d(c.etcode,t):(e="http://g.click.taobao.com/load?rf=",e+=encodeURIComponent(encodeURIComponent(n)),e+="&dr=&pid="+a,e+="&pgid="+t,e+="&ak=&ttype=2&scr=414x736&lan=2%2C0&ciid=&csid=&curl=&ckeywords=",e+="&cb=get_etcode",wx.request({url:c.etProxy.replace(":TKURL",encodeURIComponent(e)),success:function(e){var o=e.data&&(e.data.data||e.data);c.etcode=o.match(/\d+/)[0],wx.setStorage({key:"etcode",data:c.etcode}),d(c.etcode,t)}}))}function d(o,i){var r="http://g.click.taobao.com/q?pid="+a;r+="&rf="+encodeURIComponent(n),r+="&rd=2&et="+o,r+="&pgid="+i,r+="&ct="+encodeURIComponent("url="+encodeURIComponent("http://detail.tmall.com/item.htm?id="+t)),r+="&v=1.2&ttype=2&cm=&ck=-1&cw=0","function"==typeof e&&e(r)}var c=this,n=this.referer,a=this.pid;this.etProxy;this.etcode&&this.pgid?d(this.etcode,this.pgid):o(r)},module.exports=t}();