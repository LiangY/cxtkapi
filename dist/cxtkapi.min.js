!function(e){function t(){this.pid="",this.etProxy="https://",this.referer="http://",this.pgid=null,this.etcode=null}t.prototype.init=function(e){this.etProxy=e.etProxy,this.pid=e.pid,this.referer=e.referer},t.clear=function(){wx.removeStorage({key:"amvid"}),wx.removeStorage({key:"etcode"})},t.prototype.getLink=function(e,t){function o(e){var t,o,d,n="",a="",p="abcdef0123456789",s=c.substr(1),f=Math;if(r.pgid=wx.getStorageSync("amvid"),!r.pgid){a=i(s,8)+i(p,16);for(var t=1;32>=t;t++)o=f.floor(16*f.random()),a&&t<=a.length&&(d=a.charCodeAt(t-1),o=(o+d)%16),n+=o.toString(16);r.pgid=n,wx.setStorage({key:"amvid",data:r.pgid})}e(r.pgid)}function i(e,t){var o,i="",d=1;if(d=Math.floor(e.length/t),1==d)i=e.substr(0,t);else for(o=0;t>o;o++)i+=e.substr(o*d,1);return i}function d(e){var t;r.etcode=wx.getStorageSync("etcode"),r.etcode?n(r.etcode,e):(t="http://g.click.taobao.com/load?rf=",t+=encodeURIComponent(encodeURIComponent(c)),t+="&dr=&pid="+a,t+="&pgid="+e,t+="&ak=&ttype=2&scr=414x736&lan=2%2C0&ciid=&csid=&curl=&ckeywords=",t+="&cb=get_etcode",wx.request({url:r.etProxy.replace(":TKURL",encodeURIComponent(t)),success:function(t){var o=t.data&&(t.data.data||t.data);r.etcode=o.match(/\d+/)[0],wx.setStorage({key:"etcode",data:r.etcode}),n(r.etcode,e)}}))}function n(o,i){var d="http://g.click.taobao.com/q?pid="+a;d+="&rf="+encodeURIComponent(c),d+="&rd=2&et="+o,d+="&pgid="+i,d+="&ct="+encodeURIComponent("url="+encodeURIComponent(e)),d+="&v=1.2&ttype=2&cm=&ck=-1&cw=0","function"==typeof t&&t(d)}var r=this,c=this.referer,a=this.pid;this.etProxy;this.etcode&&this.pgid?n(this.etcode,this.pgid):o(d)},"function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module?module.exports=t:e.CxTkapi=t}("object"==typeof global&&global||"object"==typeof window&&window||this);