!function(){function t(){this.pid="",this.etProxy="https://",this.referer="http://",this.pgid=null,this.etcode=null}t.prototype.init=function(t){this.etProxy=t.etProxy,this.pid=t.pid,this.referer=t.referer},t.clear=function(){wx.removeStorage({key:"amvid"}),wx.removeStorage({key:"etcode"})},t.prototype.getLink=function(t,e){function o(t){var e,o,i,c="",a="",p="abcdef0123456789",s=n.substr(1),h=Math;if(d.pgid=wx.getStorageSync("amvid"),!d.pgid){a=r(s,8)+r(p,16);for(var e=1;32>=e;e++)o=h.floor(16*h.random()),a&&e<=a.length&&(i=a.charCodeAt(e-1),o=(o+i)%16),c+=o.toString(16);d.pgid=c,wx.setStorage({key:"amvid",data:d.pgid})}t(d.pgid)}function r(t,e){var o,r="",i=1;if(i=Math.floor(t.length/e),1==i)r=t.substr(0,e);else for(o=0;e>o;o++)r+=t.substr(o*i,1);return r}function i(t){var e;d.etcode=wx.getStorageSync("etcode"),d.etcode?c(d.etcode,t):(e="http://g.click.taobao.com/load?rf=",e+=encodeURIComponent(encodeURIComponent(n)),e+="&dr=&pid="+a,e+="&pgid="+t,e+="&ak=&ttype=2&scr=414x736&lan=2%2C0&ciid=&csid=&curl=&ckeywords=",e+="&cb=get_etcode",wx.request({url:d.etProxy.replace(":TKURL",encodeURIComponent(e)),success:function(e){var o=e.data&&(e.data.data||e.data);d.etcode=o.match(/\d+/)[0],wx.setStorage({key:"etcode",data:d.etcode}),c(d.etcode,t)}}))}function c(o,r){var i="http://g.click.taobao.com/q?pid="+a;i+="&rf="+encodeURIComponent(n),i+="&rd=2&et="+o,i+="&pgid="+r,i+="&ct="+encodeURIComponent("url="+encodeURIComponent(t)),i+="&v=1.2&ttype=2&cm=&ck=-1&cw=0","function"==typeof e&&e(i)}var d=this,n=this.referer,a=this.pid;this.etProxy;this.etcode&&this.pgid?c(this.etcode,this.pgid):o(i)},module.exports=t}();